## 모듈을 만드는 방법

공유하거나 재사용할 함수를 포함한 하나의 파일을 만들면 된다.

다만, 요쳥한 모듈이 `검색 경로`에 있다고 가정하는데 이 부분에서 문제가 발생할 수 있다. 

## 모듈을 어떻게 찾을까? 

인터프리터가 모듈을 찾을 때 주요 위치 3군데를 확인한다. 

1. 현재 작업 디렉토리 
2. 인터프리터의 사이트 패키지 위치
    - 서드파티 파이썬 모듈 또는 사용자가 만든 모듈을 포함하는 디렉토리 
3. 표준 라이브러리 위치 
    - 표준 라이브러리를 구성하는 모든 모듈을 포함하는 디렉토리 

인터프리터가 2번과 3번 위치를 찾는 순서는 많은 요소에 의해 달라질 수 있다. 
하지만 작동 원리를 파악하고 있다면 크게 걱정할 필요는 없다. 

중요한 건 인터프리터는 항상 `사용자의 현재 작업 디렉토리`를 `가장 먼저 검색`한다는 점이다. 

이로 인해 사용자가 만든 모듈을 사용할 때 문제가 발생할 수 있다. 

## ① 현재 작업 디렉토리

### 예제 상황
- 모듈을 저장할 mymodules 폴더 생성
- vsearch.py 파일을 만들어서 mymodules 폴더로 이동

① vsearch.py 파일을 포함하고 있는 디렉토리에서 작업한 상황

![image](https://github.com/sjHong645/head-first-python/assets/64796257/18c7aa38-8399-4b4b-9564-50681cec345a)

당연히 잘 동작한다. 

하지만... 내가 원하는 모듈이 현재 작업 디렉토리에 들어 있지 않는다면 어떻게 될까? 

- 기본적으로는 오류가 발생한다.
  - ImportErrors : 모듈을 찾을 수 없을 때 발생하는 에러
  - 어떤 OS에 있던지 간에 똑같은 이유로 오류가 발생할 수 있다.

cf) 경로는 하드코딩하지 말자. 언제든지 바뀔 수 있기 때문이다.

인터프리터는 현재 작업 디렉토리에서 모듈을 찾지 못하면 `표준 라이브러리`와 `사이트 패키지 위치`에서 모듈을 검색한다.  
이에 대해서는 아래에서 좀 더 자세히 다룬다. 

## ② 인터프리터의 사이트 패키지 위치

서드파티 모듈을 공급하고 지원하는 기능은 파이썬 코드 재사용의 핵심 기술이다. 그래서 파이썬에서는 사용자의 파이썬 설정에 모듈을 추가할 수 있도록 내장 기능을 제공한다. 

### setuptools를 활용해 모듈을 사이트 패키지에 설치하기 

- setuptools 표준 라이브러리
  - 해당 라이브러리를 활용해서 `모듈`을 `사이트 패키지`에 추가할 수 있다.

setuptools를 이용해서 아래 3가지 단계를 거쳐서 모듈을 사이트 패키지에 설치할 것이다. 

1. 배포 설명 만들기
    - setuptools로 설치할 모듈을 식별
2. 배포 파일 만들기 
    - 파이썬의 명령행에서 사용자가 만든 모듈코드를 포함하는 배포 파일을 만든다.
3. 배포 파일 설치하기 
    - 파이썬의 명령행에서 앞서 만든 배포 파일을 사이트 패키지에 설치한다. 

3단계를 거치고 나면 `모듈 배포 패키지`가 완성된다. 배포 패키지에는 모듈을 사이트 패키지에 설치하는데 필요한 모든 파일을 담고 있는 하나의 압축파일이다. 

#### 1. 배포 설명 만들기 
- `setup.py`와 `README.txt`가 필요하다. 
- 각각의 파일을 만드는 방법 

vsearch.py가 들어있는 폴더에 앞서 언급한 2개의 파일을 만들어야 한다. 

- setup.py의 코드 
``` python 

from setuptools import setup 

setup(
    # name 인자를 통해 배포 파일을 식별함 
    # 모듈 이름을 배포 파일 이름으로 사용하는 것이 일반적이다. 
    name = 'vsearch',
    version = '1.0', 
    description = 'The Head First Python Search Tools', 
    author='Hong Seung Jun', 
    author_email = '22@gmail.com', 
    url = 'headfirstlabs.com', 
    py_modules=['vsearch'] # 패키지에 포함할 py 파일 목록 
                           # 여기서는 vsearch 하나만 있음 

)
```

- README.txt  
setup.py말고 패키지 설명을 포함하는 파일. 
파일 자체는 반드시 존재해야 하지만 내용은 원하는대로 작성해도 된다. 내용이 없어도 그만이다. 

예제에서는 내용을 따로 적지 않았다. 

#### 2. 배포 파일 만들기 

- 현재 상황 : mymodules 폴더에 vsearch.py, setup.py, README.txt 파일이 있음 

이제 배포 파일을 만들 수 있다. 사용하는 OS 환경에 따라 만드는 방법에 차이가 있다. 

- windows 환경 
```
3개의 파일을 포함한 디렉토리 > py -3 setup.py sdist 

or 

3개의 파일을 포함한 디렉토리 > python -m setup sdist 
```

- UNIX 계열 환경 
```
3개의 파일을 포함한 디렉토리$ python3 setup.py sdist 
```

3개의 파일이 `vsearch-1.0.tar.gz` 라는 이름을 가진 하나의 `소스 배포 파일`로 합쳐졌다. 해당 파일은 같은 디렉토리의 `dist 디렉토리`에 저장된다. 

#### 3. 배포 파일 설치하기 

`pip(Package Installer for Python)`을 이용할 거다. 

```
배포파일을 포함한 디렉토리> pip install 압축배포파일이름
```

이제 `vsearch 모듈`이 `사이트 패키지의 일부로 설치`되었다. 

### 정리 

vesearch 모듈을 설치했기 때문에 프로그램에서 `import vsearch`를 사용할 수 있다. 당연히 인터프리터가 vsearch 모듈을 찾을 수 있는 것이다. 

이후에 모듈 코드를 고쳐야 한다면 앞서 진행했던 3단계를 반복해서 새로운 모듈을 사이트 패키지에 설치하면 된다. 새 모듈을 설치할 때는 setup.py 파일에 새로운 버전 번호를 할당했는지 꼭 확인하자. 

### 배포 파일 공유 

이제 다른 파이썬 사용자가 pip로 내가 만든 모듈을 설치할 수 있게 공유할 수 있다. 

1. 이메일, usb 등을 이용해 파일을 일일이 배포할 수도 있다. 비밀자료가 많다면 이렇게 하는게 맞겠다. 

2. PyPI라 불리는 파이썬에서 관리하는 웹 기반 SW 저장소에 올리면 누구나 내가 만든 배포 파일을 사용할 수 있다. 

- PyPI 사이트 : https://pypi.org/
- 배포 파일을 PyPI에 올리고 공유하는 방법을 소개한 온라인 가이드 : https://www.pypa.io/en/latest/
